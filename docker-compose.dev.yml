services:
  svarog-mongodb:
    image: mongo:7.0
    container_name: svarog-mongodb
    ports:
      - 27017:27017
    environment:
      - MONGODB_INITDB_ROOT_USERNAME=user
      - MONGODB_INITDB_ROOT_PASSWORD=pass
      - MONGO_REPLICA_SET_NAME=rs0
    command: >
      mongod --replSet rs0 --bind_ip_all
    volumes:
      - dbdata:/data/db
      - mongo1_config:/data/configdb
      - ./mongo-init.js:/docker-entrypoint-initdb.d/mongo-init.js:ro
  nats:
    image: nats:latest
    container_name: svarog-nats
    ports:
      - "4222:4222"
      - "${NATS_WS_PORT:-9222}:${NATS_WS_PORT:-9222}"
    command: ["--config", "/config/nats-server.conf"]
    volumes:
      - ./nats-server.conf:/config/nats-server.conf:ro
      - nats_data:/data/jetstream
    environment:
      - NATS_WS_PORT=${NATS_WS_PORT:-9222}
      - NATS_SYSTEM_USER=${NATS_SYSTEM_USER:-auth_service}
      - NATS_SYSTEM_PASSWORD=${NATS_SYSTEM_PASSWORD:-auth-service-secret-789}
      - NATS_ISSUER_PUBLIC_KEY=${NATS_ISSUER_PUBLIC_KEY:-ACOAJABFNQGIVX7KATSTGKAD6ALP6END7576EM2VSUZ53M26CXR2OSLK}
    restart: unless-stopped
volumes:
  dbdata:
  mongo1_config:
  nats_data:
